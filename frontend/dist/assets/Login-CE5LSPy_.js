import{a as w}from"./index-DUccw6c8.js";import{_ as L,u as B,g as F,m as v,a as R,i as h,b as U,n as _,e as l,w as d,r as c,o as g,F as $,A as x,c as N,f as k,t as M,E as V}from"./index-CvmFJ_Ff.js";import{s as P,u as T}from"./userCard.less_vue_type_style_index_0_src_true_lang.module-CtwgKG33.js";function y(r){this.message=r}y.prototype=new Error,y.prototype.name="InvalidCharacterError";var C=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,"");if(t.length%4==1)throw new y("'atob' failed: The string to be decoded is not correctly encoded.");for(var a,e,n=0,i=0,p="";e=t.charAt(i++);~e&&(a=n%4?64*a+e:e,n++%4)?p+=String.fromCharCode(255&a>>(-2*n&6)):0)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e);return p};function z(r){var t=r.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(a){return decodeURIComponent(C(a).replace(/(.)/g,function(e,n){var i=n.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}(t)}catch{return C(t)}}function f(r){this.message=r}function D(r,t){if(typeof r!="string")throw new f("Invalid token specified");var a=(t=t||{}).header===!0?0:1;try{return JSON.parse(z(r.split(".")[a]))}catch(e){throw new f("Invalid token specified: "+e.message)}}f.prototype=new Error,f.prototype.name="InvalidTokenError";const O={__name:"Login",setup(r){const t=B(),a=F(null),e=v({id:"",password:"",role:{roleList:[{value:1,name:"patient"},{value:2,name:"doctor"},{value:3,name:"Admin"}],selected:1}}),n=R(),i=v(T),p=async u=>{if(u)try{await u.validate();const o=e.role.selected===1?await w.loginPatient(e.id,e.password):e.role.selected===2?await w.loginDoctor(e.id,e.password):await w.loginAdmin(e.id,e.password);o.status===0&&(n.token=o.token,n.user=D(o.token),V.success(o.message),t.replace({name:"Index"}))}catch(o){V.error(o)}};return(u,o)=>{const b=c("el-input"),m=c("el-form-item"),I=c("el-radio"),S=c("el-radio-group"),A=c("el-button"),E=c("el-form");return g(),h("div",{class:_(u.$style.card)},[U("span",{class:_(u.$style.title)},"Log in",2),l(E,{ref_key:"ruleFormRef",ref:a,model:e,rules:i,"label-width":"6rem",size:"large"},{default:d(()=>[l(m,{label:"Account：",prop:"id"},{default:d(()=>[l(b,{modelValue:e.id,"onUpdate:modelValue":o[0]||(o[0]=s=>e.id=s),placeholder:"Please enter your email or cell phone number"},null,8,["modelValue"])]),_:1}),l(m,{label:"Password：",prop:"password"},{default:d(()=>[l(b,{modelValue:e.password,"onUpdate:modelValue":o[1]||(o[1]=s=>e.password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(m,{label:"Role",prop:"role"},{default:d(()=>[l(S,{modelValue:e.role.selected,"onUpdate:modelValue":o[2]||(o[2]=s=>e.role.selected=s)},{default:d(()=>[(g(!0),h($,null,x(e.role.roleList,s=>(g(),N(I,{label:s.value,key:s.value},{default:d(()=>[k(M(s.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:d(()=>[l(A,{class:_(u.$style.submitBtn),type:"primary",onClick:o[3]||(o[3]=s=>p(a.value))},{default:d(()=>[k("Submit")]),_:1},8,["class"])]),_:1})]),_:1},8,["model","rules"])],2)}}},J={$style:P},H=L(O,[["__cssModules",J]]);export{H as default};
